<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý Owner - RobloxAccShop</title>
    <link rel="stylesheet" href="admin.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="admin-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-user-shield"></i>
                    <span>Owner Panel</span>
                </div>
            </div>
            <nav class="sidebar-nav">
                <a href="trangquantri.html" class="nav-item">
                    <i class="fas fa-arrow-left"></i>
                    <span>Quay lại</span>
                </a>
                <a href="#" class="nav-item active" data-tab="account">
                    <i class="fas fa-user-cog"></i>
                    <span>Tài khoản</span>
                </a>
                <a href="#" class="nav-item" data-tab="security">
                    <i class="fas fa-shield-alt"></i>
                    <span>Bảo mật</span>
                </a>
                <a href="#" class="nav-item" data-tab="backup">
                    <i class="fas fa-database"></i>
                    <span>Sao lưu</span>
                </a>
                <a href="#" class="nav-item" data-tab="logs">
                    <i class="fas fa-clipboard-list"></i>
                    <span>Nhật ký</span>
                </a>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <header class="admin-header">
                <div class="header-left">
                    <h1 class="page-title" id="pageTitle">Quản lý Owner</h1>
                </div>
                <div class="header-right">
                    <button class="btn-logout" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i>
                        Đăng xuất
                    </button>
                </div>
            </header>

            <div class="content-area">
                <!-- Account Tab -->
                <div class="tab-content active" id="accountTab">
                    <div class="settings-section">
                        <div class="settings-card">
                            <h3 class="settings-title">Thông tin tài khoản Owner</h3>
                            <form class="settings-form" id="ownerForm">
                                <div class="form-group">
                                    <label for="ownerUsername">Tên đăng nhập</label>
                                    <input type="text" id="ownerUsername" value="owner" readonly>
                                </div>
                                <div class="form-group">
                                    <label for="ownerEmail">Email</label>
                                    <input type="email" id="ownerEmail" value="owner@robloxaccshop.com" required>
                                </div>
                                <div class="form-group">
                                    <label for="currentPassword">Mật khẩu hiện tại</label>
                                    <input type="password" id="currentPassword" placeholder="Nhập mật khẩu hiện tại">
                                </div>
                                <div class="form-group">
                                    <label for="newPassword">Mật khẩu mới</label>
                                    <input type="password" id="newPassword" placeholder="Nhập mật khẩu mới">
                                </div>
                                <div class="form-group">
                                    <label for="confirmPassword">Xác nhận mật khẩu</label>
                                    <input type="password" id="confirmPassword" placeholder="Xác nhận mật khẩu mới">
                                </div>
                                <button type="submit" class="btn-primary">Cập nhật thông tin</button>
                            </form>
                        </div>

                        <div class="settings-card">
                            <h3 class="settings-title">Quản lý quyền hệ thống</h3>
                            <div class="permissions-management">
                                <div class="permission-item">
                                    <div class="permission-info">
                                        <span class="permission-name">Thêm Admin</span>
                                        <span class="permission-desc">Cấp quyền quản trị viên cho người dùng</span>
                                    </div>
                                    <button class="btn-primary btn-sm" onclick="manageAdmins()">
                                        Quản lý
                                    </button>
                                </div>
                                <div class="permission-item">
                                    <div class="permission-info">
                                        <span class="permission-name">Quản lý CTV</span>
                                        <span class="permission-desc">Thêm/xóa cộng tác viên</span>
                                    </div>
                                    <button class="btn-primary btn-sm" onclick="manageCTVs()">
                                        Quản lý
                                    </button>
                                </div>
                                <div class="permission-item">
                                    <div class="permission-info">
                                        <span class="permission-name">Cấu hình hệ thống</span>
                                        <span class="permission-desc">Thay đổi cài đặt quan trọng</span>
                                    </div>
                                    <button class="btn-primary btn-sm" onclick="systemConfig()">
                                        Cấu hình
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Security Tab -->
                <div class="tab-content" id="securityTab">
                    <div class="settings-section">
                        <div class="settings-card">
                            <h3 class="settings-title">Cài đặt bảo mật</h3>
                            <form class="settings-form">
                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" checked>
                                        <span class="checkmark"></span>
                                        Yêu cầu xác thực 2 lớp cho Owner
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" checked>
                                        <span class="checkmark"></span>
                                        Ghi log các hoạt động quan trọng
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox">
                                        <span class="checkmark"></span>
                                        Giới hạn đăng nhập theo IP
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label for="sessionTimeout">Thời gian timeout phiên làm việc (phút)</label>
                                    <input type="number" id="sessionTimeout" value="30" min="5" max="240">
                                </div>
                                <button type="submit" class="btn-primary">Lưu cài đặt</button>
                            </form>
                        </div>

                        <div class="settings-card">
                            <h3 class="settings-title">Phiên đăng nhập hiện tại</h3>
                            <div class="session-info">
                                <div class="session-item">
                                    <span class="session-label">Thời gian bắt đầu:</span>
                                    <span class="session-value" id="sessionStart">--</span>
                                </div>
                                <div class="session-item">
                                    <span class="session-label">Địa chỉ IP:</span>
                                    <span class="session-value" id="sessionIP">--</span>
                                </div>
                                <div class="session-item">
                                    <span class="session-label">Trình duyệt:</span>
                                    <span class="session-value" id="sessionBrowser">--</span>
                                </div>
                                <div class="session-actions">
                                    <button class="btn-secondary" onclick="refreshSession()">
                                        <i class="fas fa-sync"></i> Làm mới
                                    </button>
                                    <button class="btn-primary" onclick="terminateOtherSessions()">
                                        <i class="fas fa-times"></i> Kết thúc phiên khác
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Backup Tab -->
                <div class="tab-content" id="backupTab">
                    <div class="settings-section">
                        <div class="settings-card">
                            <h3 class="settings-title">Sao lưu dữ liệu</h3>
                            <div class="backup-actions">
                                <button class="btn-primary" onclick="createBackup()">
                                    <i class="fas fa-download"></i>
                                    Tạo bản sao lưu
                                </button>
                                <button class="btn-secondary" onclick="restoreBackup()">
                                    <i class="fas fa-upload"></i>
                                    Khôi phục dữ liệu
                                </button>
                            </div>
                            <div class="backup-info">
                                <h4>Lần sao lưu gần nhất:</h4>
                                <p id="lastBackup">Chưa có bản sao lưu nào</p>
                            </div>
                        </div>

                        <div class="settings-card">
                            <h3 class="settings-title">Tự động sao lưu</h3>
                            <form class="settings-form">
                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" checked>
                                        <span class="checkmark"></span>
                                        Bật tự động sao lưu
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label for="backupFrequency">Tần suất sao lưu</label>
                                    <select id="backupFrequency">
                                        <option value="daily">Hàng ngày</option>
                                        <option value="weekly" selected>Hàng tuần</option>
                                        <option value="monthly">Hàng tháng</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="backupTime">Thời gian sao lưu</label>
                                    <input type="time" id="backupTime" value="02:00">
                                </div>
                                <button type="submit" class="btn-primary">Lưu cài đặt</button>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Logs Tab -->
                <div class="tab-content" id="logsTab">
                    <div class="tab-header">
                        <h2 class="tab-title">Nhật ký hệ thống</h2>
                        <div class="filter-options">
                            <select id="logTypeFilter">
                                <option value="all">Tất cả</option>
                                <option value="security">Bảo mật</option>
                                <option value="transaction">Giao dịch</option>
                                <option value="system">Hệ thống</option>
                            </select>
                            <button class="btn-secondary" onclick="clearLogs()">
                                <i class="fas fa-trash"></i>
                                Xóa nhật ký
                            </button>
                        </div>
                    </div>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Thời gian</th>
                                    <th>Loại</th>
                                    <th>Nội dung</th>
                                    <th>Người dùng</th>
                                    <th>IP</th>
                                </tr>
                            </thead>
                            <tbody id="logsTableBody">
                                <!-- Logs will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="auth.js"></script>
    <script src="security.js"></script>
    <script>
        // Owner-specific functionality
        function manageAdmins() {
            alert('Tính năng quản lý Admin đang được phát triển!');
        }

        function manageCTVs() {
            alert('Tính năng quản lý CTV đang được phát triển!');
        }

        function systemConfig() {
            alert('Tính năng cấu hình hệ thống đang được phát triển!');
        }

        function createBackup() {
            // Create backup of all data
            const backup = {
                timestamp: new Date().toISOString(),
                users: localStorage.getItem('shop_users'),
                products: localStorage.getItem('shop_products'),
                transactions: localStorage.getItem('shop_transactions'),
                promoCodes: localStorage.getItem('shop_promocodes')
            };

            // Download as JSON file
            const dataStr = JSON.stringify(backup, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `backup-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);

            window.authSystem.showMessage('Đã tạo bản sao lưu thành công!', 'success');
        }

        function restoreBackup() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const backup = JSON.parse(e.target.result);
                        
                        if (confirm('Bạn có chắc chắn muốn khôi phục dữ liệu? Hành động này không thể hoàn tác!')) {
                            if (backup.users) localStorage.setItem('shop_users', backup.users);
                            if (backup.products) localStorage.setItem('shop_products', backup.products);
                            if (backup.transactions) localStorage.setItem('shop_transactions', backup.transactions);
                            if (backup.promoCodes) localStorage.setItem('shop_promocodes', backup.promoCodes);
                            
                            window.authSystem.showMessage('Khôi phục dữ liệu thành công!', 'success');
                            setTimeout(() => location.reload(), 1000);
                        }
                    } catch (error) {
                        window.authSystem.showMessage('File sao lưu không hợp lệ!', 'error');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        function refreshSession() {
            window.authSystem.showMessage('Đã làm mới thông tin phiên!', 'success');
        }

        function terminateOtherSessions() {
            if (confirm('Bạn có chắc chắn muốn kết thúc tất cả các phiên đăng nhập khác?')) {
                window.authSystem.showMessage('Đã kết thúc các phiên đăng nhập khác!', 'success');
            }
        }

        function clearLogs() {
            if (confirm('Bạn có chắc chắn muốn xóa tất cả nhật ký?')) {
                localStorage.removeItem('security_logs');
                localStorage.removeItem('page_views');
                window.authSystem.showMessage('Đã xóa nhật ký!', 'success');
                loadLogs();
            }
        }

        function loadLogs() {
            const tbody = document.getElementById('logsTableBody');
            if (!tbody) return;

            const securityLogs = JSON.parse(localStorage.getItem('security_logs') || '[]');
            const pageViews = JSON.parse(localStorage.getItem('page_views') || '[]');
            
            const allLogs = [
                ...securityLogs.map(log => ({...log, type: 'security', user: 'System'})),
                ...pageViews.map(view => ({...view, type: 'system', user: 'Unknown', message: `Truy cập trang: ${view.page}`}))
            ].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

            tbody.innerHTML = allLogs.map(log => `
                <tr>
                    <td>${new Date(log.timestamp).toLocaleString('vi-VN')}</td>
                    <td>
                        <span class="log-type ${log.type}">${log.type}</span>
                    </td>
                    <td>${log.message}</td>
                    <td>${log.user}</td>
                    <td>${log.ip || 'N/A'}</td>
                </tr>
            `).join('');
        }

        // Initialize owner page
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is owner
            if (!window.authSystem || !window.authSystem.hasOwnerAccess()) {
                window.authSystem.showMessage('Chỉ Owner mới có quyền truy cập trang này!', 'error');
                setTimeout(() => {
                    window.location.href = 'trangquantri.html';
                }, 2000);
                return;
            }

            // Load logs
            loadLogs();

            // Setup tab switching
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    if (item.getAttribute('href')) return; // Skip links with href
                    
                    e.preventDefault();
                    const tabName = item.getAttribute('data-tab');
                    
                    // Update navigation
                    document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                    item.classList.add('active');
                    
                    // Update content
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(`${tabName}Tab`).classList.add('active');
                    
                    // Update page title
                    document.getElementById('pageTitle').textContent = item.querySelector('span').textContent;
                });
            });

            // Update session info
            document.getElementById('sessionStart').textContent = new Date().toLocaleString('vi-VN');
            document.getElementById('sessionBrowser').textContent = navigator.userAgent.split(' ')[0];
        });
    </script>
</body>
</html>
